<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="multi.com.finalproject">

	<select id="M_SELECT_ONE"
		resultType="multi.com.finalproject.member.model.MemberVO">
		select * from member where id = #{id}
	</select>

	<select id="M_ID_CHECK"
		resultType="multi.com.finalproject.member.model.MemberVO">
		select id from member where id = #{id}
	</select>

	<select id="M_NICK_CHECK"
		resultType="multi.com.finalproject.member.model.MemberVO">
		select nickname from member where nickname = #{nickname}
	</select>

	<select id="LOGIN"
		resultType="multi.com.finalproject.member.model.MemberVO">
		select * from member where id = #{id} and pw = #{pw} 
	</select>

	<select id="M_SEARCH_LIST_NAME"
		resultType="multi.com.finalproject.member.model.MemberVO">
		select * from member where name like #{searchWord}
	</select>

	<select id="M_SEARCH_LIST_TEL"
		resultType="multi.com.finalproject.member.model.MemberVO">
		select * from member where tel like #{searchWord}
	</select>
	
	<insert id="M_INSERT"
		parameterType="multi.com.finalproject.member.model.MemberVO">
		insert into
		member(id,pw,nickname,profilepic,question,answer,name,tel,email)
		values(#{id},#{pw},#{nickname},#{profilepic},#{question},#{answer},#{name},#{tel},#{email})
	</insert>

	<update id="M_UPDATE"
		parameterType="multi.com.finalproject.member.model.MemberVO">
		update member set pw=#{pw} , name=#{name} , tel=#{tel} ,
		profilepic=#{profilepic} , nickname=#{nickname} ,
		email=#{email} where id = #{id}
	</update>

	<delete id="M_DELETE" parameterType="multi.com.finalproject.member.model.MemberVO"> 
		delete from member where id = #{id} 
 	</delete>

	<select id="FIND_ID_EMAIL"
		parameterType="multi.com.finalproject.member.model.MemberVO">
		select id from member where email = #{email}
	</select>
	
	<select id="FIND_ID_TEL"
		parameterType="multi.com.finalproject.member.model.MemberVO">
		select id from member where tel = #{tel}
	</select>

	<select id="FIND_PW_EMAIL"
		parameterType="multi.com.finalproject.member.model.MemberVO">
		select id from member where email = #{email}
	</select>
	<select id="FIND_PW_TEL"
		parameterType="multi.com.finalproject.member.model.MemberVO">
		select id from member where tel = #{tel}
		
	</select>
	<!--
        로그인된 경우 해당 세션id와 유효시간을 사용자 테이블에 세팅한다.
     -->
    <update id="KEEP_LOGIN">
        update member set sessionKey = #{sessionId}, sessionLimit = #{next} where id=#{id}
    </update>
     
    <!--
        유효기간이 남아 있으면서 해당 sessionId를 가지는 사용자 정보를 꺼내오는 부분
     -->
    <select id="CHECK_USER_WITH_SESSIONKEY" resultType="multi.com.finalproject.member.model.MemberVO">
        select * from member where sessionKey = #{sessionId} and sessionLimit > now()
    </select>
     
</mapper>