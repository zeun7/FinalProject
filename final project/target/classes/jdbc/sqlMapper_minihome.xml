<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="multi.com.finalproject.minihome">
	
	<select id="MINI_SELECT_ONE" resultType="multi.com.finalproject.minihome.model.MiniHomeVO">
		select * from minihome where id = #{id}
	</select>
	
	<update id="MINI_UPDATE" parameterType="multi.com.finalproject.minihome.model.MiniHomeVO">
		update minihome set title=#{title}, message=#{message}, backimg=#{backimg}, bgm=#{bgm} where id=#{id}
	</update>
	
	<select id="SELECT_NICK_PIC" resultType="multi.com.finalproject.member.model.MemberVO">
		select profilepic, nickname from member where id=#{id}
	</select>
		
	<select id="HAS_VISITED_TODAY" resultType="Integer">
		select count(*) from visit_history where to_char(visit_date, 'YYYYMMDD')=#{visit_date} 
		and (user_id=#{user_id}) and (minihome_id=#{minihome_id})
	</select>
	
	<update id="VCOUNT_UP" parameterType="multi.com.finalproject.minihome.model.MiniHomeVO">
		update minihome set vtoday=vtoday+1, vtotal=vtotal+1 where id=#{id}
	</update>
	
	<insert id="ADD_VISIT_HISTORY" parameterType="multi.com.finalproject.minihome.model.VisitHistoryVO">
		insert into visit_history(user_id,minihome_id) values(#{user_id},#{minihome_id})
	</insert>
	
	<update id="RESET_VTODAY_ALL" parameterType="multi.com.finalproject.minihome.model.MiniHomeVO">
		update minihome set vtoday=0
	</update>
	
	<select id="RANDOM_MINI_HOME" resultType="multi.com.finalproject.minihome.model.MiniHomeVO">
		select * from minihome order by dbms_random.random fetch first 1 rows only
	</select>
	
</mapper>